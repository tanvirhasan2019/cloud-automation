apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "wordpress.fullname" . }}-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "wordpress.labels" . | nindent 4 }}
data:
  {{- if .Values.wordpressExtraConfigContent }}
  wordpress-extra-config.php: |
    <?php
    /**
     * WordPress Extra Configuration
     * Generated by Helm Chart
     */
    {{ .Values.wordpressExtraConfigContent | nindent 4 }}
    
    // Additional configuration for enterprise environments
    define('AUTOMATIC_UPDATER_DISABLED', {{ ternary "true" "false" (eq .Values.wordpressAutoUpdateLevel "none") }});
    define('WP_AUTO_UPDATE_CORE', {{ .Values.wordpressAutoUpdateLevel | quote }});
    define('DISALLOW_FILE_EDIT', true);
    define('DISALLOW_FILE_MODS', false);
    
    // Security configurations
    define('FORCE_SSL_ADMIN', true);
    define('WP_CACHE', true);
    
    // Performance optimizations
    define('WP_POST_REVISIONS', 10);
    
    // Debug settings (disabled in production)
    define('WP_DEBUG', false);
    define('WP_DEBUG_LOG', false);
    define('WP_DEBUG_DISPLAY', false);
    define('SCRIPT_DEBUG', false);
    
    // Custom database configurations
    $table_prefix = '{{ .Values.wordpressTablePrefix }}';
    
    // That's all, stop editing! Happy blogging.
  {{- end }}
  
  php.ini: |
    [PHP]
    memory_limit = 256M
    max_execution_time = 300
    upload_max_filesize = 50M
    post_max_size = 50M
    
    [opcache]
    opcache.enable=1
    opcache.memory_consumption=128
    opcache.interned_strings_buffer=8
    opcache.max_accelerated_files=4000
    opcache.revalidate_freq=60
    opcache.fast_shutdown=1